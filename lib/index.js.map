{"version":3,"sources":["../src/index.js"],"names":["Promise","connect","jest","fn","ops","mockedReturn","op","modelName","cb","mock","mockingoose","__mocks","err","Error","reject","resolve","forEach","Query","prototype","mockImplementation","condition","exec","call","model","Model","save","options","constructor","doMock","target","traps","get","prop","hasOwnProperty","Reflect","toReturn","o","Proxy"],"mappings":";;;;;;AAAA;;;;;;;;AAEA,mBAASA,OAAT,GAAmBA,OAAnB;AACA,mBAASC,OAAT,GAAmBC,KAAKC,EAAL,EAAnB;;AAEA,IAAMC,MAAM,CACV,MADU,EAEV,SAFU,EAGV,OAHU,EAIV,UAJU,EAKV,kBALU,EAMV,kBANU,EAOV,QAPU,EAQV,WARU,EASV,YATU,CAAZ;;AAYA,IAAMC,eAAe,SAAfA,YAAe,CAACC,EAAD,EAAKC,SAAL,EAAgBC,EAAhB,EAAuB;AAC1C,MAAMC,OAAOC,YAAYC,OAAZ,CAAoBJ,SAApB,EAA+BD,EAA/B,CAAb;AACA,MAAIM,MAAM,IAAV;;AAEA,MAAGH,gBAAgBI,KAAnB,EAA0BD,MAAMH,IAAN;;AAE1B,MAAGD,EAAH,EAAO,OAAOA,GAAGI,GAAH,EAAQH,IAAR,CAAP;;AAEP,MAAGG,GAAH,EAAQ,OAAOZ,QAAQc,MAAR,CAAeF,GAAf,CAAP;AACR,SAAOZ,QAAQe,OAAR,CAAgBN,IAAhB,CAAP;AACD,CAVD;;AAYAL,IAAIY,OAAJ,CAAY,cAAM;AAChB,qBAASC,KAAT,CAAeC,SAAf,CAAyBZ,EAAzB,IAA+BJ,KAAKC,EAAL,GAAUgB,kBAAV,CAA6B,UAAUC,SAAV,EAAqBZ,EAArB,EAAyB;AACnF,SAAKF,EAAL,GAAUA,EAAV;;AAEA,QAAG,CAACE,EAAJ,EAAQ,OAAO,IAAP;;AAER,WAAO,KAAKa,IAAL,CAAUC,IAAV,CAAe,IAAf,EAAqBd,EAArB,CAAP;AACD,GAN8B,CAA/B;AAOD,CARD;;AAUA,mBAASS,KAAT,CAAeC,SAAf,CAAyBG,IAAzB,GAAgCnB,KAAKC,EAAL,GAAUgB,kBAAV,CAA6B,SAASX,EAAT,CAAYA,EAAZ,EAAgB;AAAA,MACnEF,EADmE,GACvC,IADuC,CACnEA,EADmE;AAAA,MACtDC,SADsD,GACvC,IADuC,CAC/DgB,KAD+D,CACtDhB,SADsD;;;AAG3E,SAAOF,aAAaC,EAAb,EAAiBC,SAAjB,EAA4BC,EAA5B,CAAP;AACD,CAJ+B,CAAhC;;AAMA,mBAASgB,KAAT,CAAeN,SAAf,CAAyBO,IAAzB,GAAgC,UAASC,OAAT,EAAkBlB,EAAlB,EAAsB;AACpD,MAAMF,KAAK,MAAX;AADoD,MAE5CC,SAF4C,GAE9B,KAAKoB,WAFyB,CAE5CpB,SAF4C;;;AAIpD,MAAG,OAAOmB,OAAP,KAAmB,UAAtB,EAAkClB,KAAKkB,OAAL;;AAElC,SAAOrB,aAAaC,EAAb,EAAiBC,SAAjB,EAA4BC,EAA5B,CAAP;AACD,CAPD;;AASAN,KAAK0B,MAAL,CAAY,UAAZ,EAAwB;AAAA;AAAA,CAAxB;;AAEA,IAAMC,SAAS;AACblB,WAAS;AADI,CAAf;;AAIA,IAAMmB,QAAQ;AACZC,KADY,eACRF,MADQ,EACAG,IADA,EACM;AAChB,QAAGH,OAAOI,cAAP,CAAsBD,IAAtB,CAAH,EAAgC,OAAOE,QAAQH,GAAR,CAAYF,MAAZ,EAAoBG,IAApB,CAAP;;AAEhC,WAAO;AACLG,cADK,oBACIC,CADJ,EACoB;AAAA,YAAb9B,EAAa,uEAAR,MAAQ;;AACvBuB,eAAOlB,OAAP,CAAeqB,IAAf,wBACG1B,EADH,EACQ8B,CADR;AAGD;AALI,KAAP;AAOD;AAXW,CAAd;;AAcA,IAAM1B,cAAc,IAAI2B,KAAJ,CAAUR,MAAV,EAAkBC,KAAlB,CAApB;;kBAEepB,W","file":"index.js","sourcesContent":["import mongoose from 'mongoose';\r\n\r\nmongoose.Promise = Promise;\r\nmongoose.connect = jest.fn();\r\n\r\nconst ops = [\r\n  'find',\r\n  'findOne',\r\n  'count',\r\n  'distinct',\r\n  'findOneAndUpdate',\r\n  'findOneAndRemove',\r\n  'remove',\r\n  'deleteOne',\r\n  'deleteMany'\r\n];\r\n\r\nconst mockedReturn = (op, modelName, cb) => {\r\n  const mock = mockingoose.__mocks[modelName][op];\r\n  let err = null;\r\n\r\n  if(mock instanceof Error) err = mock;\r\n\r\n  if(cb) return cb(err, mock);\r\n\r\n  if(err) return Promise.reject(err);\r\n  return Promise.resolve(mock)\r\n};\r\n\r\nops.forEach(op => {\r\n  mongoose.Query.prototype[op] = jest.fn().mockImplementation(function (condition, cb) {\r\n    this.op = op;\r\n\r\n    if(!cb) return this;\r\n\r\n    return this.exec.call(this, cb);\r\n  })\r\n});\r\n\r\nmongoose.Query.prototype.exec = jest.fn().mockImplementation(function cb(cb) {\r\n  const { op, model: { modelName }} = this;\r\n\r\n  return mockedReturn(op, modelName, cb);\r\n});\r\n\r\nmongoose.Model.prototype.save = function(options, cb) {\r\n  const op = 'save';\r\n  const { modelName } = this.constructor;\r\n\r\n  if(typeof options === 'function') cb = options;\r\n\r\n  return mockedReturn(op, modelName, cb);\r\n};\r\n\r\njest.doMock('mongoose', () => mongoose);\r\n\r\nconst target = {\r\n  __mocks: {}\r\n};\r\n\r\nconst traps = {\r\n  get(target, prop) {\r\n    if(target.hasOwnProperty(prop)) return Reflect.get(target, prop);\r\n\r\n    return {\r\n      toReturn(o, op = 'find') {\r\n        target.__mocks[prop] = {\r\n          [op]: o\r\n        };\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nconst mockingoose = new Proxy(target, traps);\r\n\r\nexport default mockingoose;\r\n"]}